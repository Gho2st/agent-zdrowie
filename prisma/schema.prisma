// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// --- ENUMY (Słowniki) ---

enum Gender {
  MALE
  FEMALE
}

enum ActivityLevel {
  LOW
  MODERATE
  HIGH
}

enum MeasurementType {
  BLOOD_PRESSURE
  GLUCOSE
  WEIGHT
  HEART_RATE
}

// --- MODELE ---

// 1. Użytkownik i Autoryzacja
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  image     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  healthProfile HealthProfile?
  measurements  Measurement[]
  dailyCheckins DailyCheckin[]
}

// 2. Profil Medyczny
model HealthProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  birthdate     DateTime
  gender        Gender
  height        Int
  weight        Float
  activityLevel ActivityLevel

  hasDiabetes          Boolean      @default(false) // Cukrzyca
  hasPrediabetes       Boolean      @default(false) // Stan przedcukrzycowy
  hasHypertension      Boolean      @default(false) // Nadciśnienie
  hasHeartDisease      Boolean      @default(false) // CVD (Choroby serca)
  hasKidneyDisease     Boolean      @default(false) // CKD (Choroby nerek)
  hasHighBloodPressure Boolean      @default(false) // Podwyzszone cisnienie
  // Pozostałe choroby (np. astma, alergie) nadal mogą być tutaj
  conditions           Condition[]
  medications          String?
  healthDataConsent    Boolean      @default(false)
  healthDataConsentAt  DateTime? // data i godzina udzielenia zgody RODO
  norms                HealthNorms?
}

// 3. Słownik Chorób
model Condition {
  id       Int             @id @default(autoincrement())
  name     String          @unique
  profiles HealthProfile[]
}

// 4. Wyliczone Normy
model HealthNorms {
  id        String        @id @default(cuid())
  profileId String        @unique
  profile   HealthProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  optimalSystolicMax  Int
  elevatedSystolicMax  Int
  systolicMin  Int
  
  optimalDiastolicMax Int
  elevatedDiastolicMax Int
  diastolicMin Int

  glucoseFastingMax  Int
  glucoseFastingMin  Int
  glucosePostMealMax Int

  weightMin Float
  weightMax Float
  bmi       Float

  pulseMin Int
  pulseMax Int

  maxHeartRate Int

  targetHeartRateMin Int
  targetHeartRateMax Int
}

// 5. Pomiary
model Measurement {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  type MeasurementType
  unit String

  value  Float
  value2 Float?

  context   String?
  note      String?
  createdAt DateTime @default(now())
}

// 6. Dziennik Samopoczucia
model DailyCheckin {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  date DateTime @default(now())

  mood   Int  @default(3)
  sleep  Int?
  energy Int  @default(3)
  stress Int  @default(3)

  @@unique([userId, date])
}
